<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Wings That Heal</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #FFD700;
            --primary-dark: #F39C12;
            --accent-green: #2ecc71;
            --danger: #e74c3c;
            --bg-dark: #1a1a1a;
            --honey-glow: rgba(255, 215, 0, 0.4);
            --glass: rgba(0, 0, 0, 0.7);
        }

        body { 
            margin: 0; overflow: hidden; background: var(--bg-dark); 
            font-family: 'Nunito', sans-serif; 
            touch-action: none; user-select: none; -webkit-user-select: none;
            width: 100vw; height: 100vh;
        }

        canvas { display: block; }

        /* --- Overlays de Efeito --- */
        #suffocation-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 40%, #000 150%);
            pointer-events: none; z-index: 100; opacity: 0; transition: opacity 0.5s;
        }

        #day-night-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000022; pointer-events: none; z-index: 50; 
            opacity: 0; transition: opacity 1s linear;
        }

        /* --- UI de Jogo (HUD) --- */
        #rpg-hud {
            position: fixed; top: 15px; left: 15px; z-index: 1000;
            display: flex; flex-direction: column; gap: 8px; pointer-events: none;
        }

        #hud-info {
            background: var(--glass); padding: 8px 15px; border-radius: 20px;
            color: white; border-left: 4px solid var(--primary); backdrop-filter: blur(5px);
        }

        .hud-stat-row {
            display: flex; align-items: center; gap: 10px; width: 200px;
            background: rgba(0,0,0,0.5); padding: 4px 10px; border-radius: 12px;
        }

        .hud-bar-bg { flex: 1; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; }
        .hud-bar-fill { height: 100%; width: 0%; transition: width 0.3s ease; }
        .hud-text { font-size: 11px; color: #eee; width: 45px; text-align: right; font-family: monospace; }

        #hud-time {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: var(--glass); color: var(--primary); padding: 5px 15px;
            border-radius: 20px; font-weight: 900; z-index: 1000; font-size: 13px;
        }

        /* --- Ranking --- */
        #ranking-container {
            position: fixed; top: 15px; right: 15px; z-index: 1000;
            background: var(--glass); padding: 12px; border-radius: 15px;
            min-width: 140px; pointer-events: none; backdrop-filter: blur(5px);
        }
        .rank-item { display: flex; justify-content: space-between; font-size: 12px; color: #ccc; margin-top: 4px; }

        /* --- Modais e Lobby --- */
        #lobby-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 5000;
            background: url('assets/background_lobby.png') center/cover no-repeat;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .lobby-modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(20, 20, 20, 0.95); border: 2px solid var(--primary);
            width: 90%; max-width: 400px; padding: 30px; border-radius: 25px;
            color: white; z-index: 6000; backdrop-filter: blur(10px);
        }
        .lobby-modal.active { display: block; }

        .btn-action {
            width: 100%; padding: 18px; border-radius: 15px; border: none;
            background: var(--primary); color: #2c1e0f; font-weight: 900;
            text-transform: uppercase; cursor: pointer; margin-top: 15px;
        }

        input {
            width: 100%; padding: 15px; margin-top: 8px; border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.4);
            color: white; font-family: inherit; box-sizing: border-box;
        }

        /* --- Toast Messages --- */
        #toast-msg {
            position: fixed; top: 10%; left: 50%; transform: translateX(-50%);
            background: var(--primary); color: #000; padding: 12px 30px;
            border-radius: 30px; font-weight: 900; z-index: 9999;
            opacity: 0; transition: opacity 0.3s; pointer-events: none;
        }

        /* Popups de Jogo */
        .modal-overlay {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; border-radius: 20px; padding: 20px; z-index: 8000;
            width: 80%; max-width: 300px; text-align: center; color: #333;
        }
    </style>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="suffocation-overlay"></div>
    <div id="day-night-overlay"></div> 
    <div id="toast-msg"></div>

    <div id="rpg-hud" style="display:none;">
        <div id="hud-info">
            <span id="hud-name">---</span> <small>LV <span id="hud-lvl">1</span></small>
        </div>
        <div class="hud-stat-row">
            <div class="hud-bar-bg"><div id="bar-hp-fill" class="hud-bar-fill" style="background:var(--danger)"></div></div>
            <div id="bar-hp-text" class="hud-text">0/0</div>
        </div>
        <div class="hud-stat-row">
            <div class="hud-bar-bg"><div id="bar-xp-fill" class="hud-bar-fill" style="background:#3498db"></div></div>
            <div id="bar-xp-text" class="hud-text">0/0</div>
        </div>
        <div class="hud-stat-row">
            <div class="hud-bar-bg"><div id="bar-pollen-fill" class="hud-bar-fill" style="background:var(--primary)"></div></div>
            <div id="bar-pollen-text" class="hud-text">0/0</div>
        </div>
    </div>

    <div id="hud-time"></div>
    <div id="hud-coords" style="display:none"></div>

    <div id="ranking-container" style="display:none;">
        <div style="font-size:10px; font-weight:900; color:var(--primary); margin-bottom:5px;">RANKING</div>
        <div id="ranking-list"></div>
        <div id="ranking-full-list" style="display:none"></div>
    </div>

    <div id="faint-screen" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:9000; flex-direction:column; align-items:center; justify-content:center; color:white;">
        <h2 style="color:var(--primary)">ASAS CA√çDAS</h2>
        <p>Aguarde um resgate ou retorne √† base.</p>
        <button id="btn-immediate-respawn" class="btn-action" style="width:auto; padding:15px 40px;">VOLTAR PARA BASE</button>
    </div>

    <div id="lobby-overlay">
        <div id="main-menu" class="main-menu-container">
            <button class="main-menu-btn" onclick="openModal('modal-create')">‚ú® Criar Colmeia</button>
            <button class="main-menu-btn" onclick="openModal('modal-join')">üöÄ Entrar na Colmeia</button>
        </div>

        <div id="modal-create" class="lobby-modal">
            <div class="modal-header">NOVA COLMEIA</div>
            <input type="text" id="host-nickname" placeholder="Seu Nome">
            <input type="text" id="create-id" placeholder="ID da Colmeia">
            <input type="password" id="create-pass" placeholder="Senha (Opcional)">
            <input type="text" id="world-seed" value="JARDIM_SOLAR" placeholder="Seed do Mundo">
            <button id="btn-create" class="btn-action">CRIAR</button>
            <button onclick="closeAllModals()" style="background:none; border:none; color:#777; width:100%; margin-top:10px; cursor:pointer;">VOLTAR</button>
        </div>

        <div id="modal-join" class="lobby-modal">
            <div class="modal-header">ENTRAR</div>
            <input type="text" id="join-nickname" placeholder="Seu Nome">
            <input type="text" id="join-id" placeholder="ID da Colmeia">
            <input type="password" id="join-pass" placeholder="Senha">
            <button id="btn-join" class="btn-action">ENTRAR</button>
            <button onclick="closeAllModals()" style="background:none; border:none; color:#777; width:100%; margin-top:10px; cursor:pointer;">VOLTAR</button>
        </div>
    </div>

    <button id="chat-toggle-btn" style="display:none;">üí¨</button>
    <div id="chat-container"></div>

    <div id="player-modal" class="modal-overlay">
        <div id="modal-player-name" style="font-weight:900;">---</div>
        <div id="modal-player-info">LV 1</div>
        <button id="btn-party-action" class="btn-action">CONVIDAR</button>
        <button id="btn-whisper-action" class="btn-action" style="background:#3498db">COCHICHAR</button>
        <button onclick="document.getElementById('player-modal').style.display='none'">FECHAR</button>
    </div>

    <div id="party-invite-popup" class="modal-overlay">
        <div class="modal-header" style="color:var(--accent-green)">CONVITE!</div>
        <div id="invite-msg"></div>
        <button id="btn-accept-invite" class="btn-action">ACEITAR</button>
        <button onclick="document.getElementById('party-invite-popup').style.display='none'">RECUSAR</button>
    </div>

    <script>
        function openModal(id) {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById(id).classList.add('active');
        }
        function closeAllModals() {
            document.querySelectorAll('.lobby-modal').forEach(m => m.classList.remove('active'));
            document.getElementById('main-menu').style.display = 'flex';
        }
    </script>
    <script type="module" src="src/main.js"></script>
</body>
</html>
